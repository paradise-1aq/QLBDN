@model QLBDN.Models.News

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "ƒêƒÉng b√†i vi·∫øt m·ªõi";
}

@section Styles {
    <!-- Quill Editor CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />

    <style>
        .create-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        /* ---------------- HEADER ---------------- */
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #059669;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
        }

        .back-link:hover {
            color: #047857;
            transform: translateX(-3px);
        }

        .page-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 800;
            color: #059669;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .page-subtitle {
            color: #64748b;
            font-size: 0.95rem;
        }

        /* ---------------- FORM CARD ---------------- */
        .form-card {
            background: white;
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            border: 1px solid #f1f5f9;
            animation: fadeIn 0.5s ease;
        }

        @@keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ---------------- INFO BOX ---------------- */
        .info-box {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            border-radius: 12px;
            padding: 1rem 1.25rem;
            border: 1px solid #93c5fd;
            margin-bottom: 2rem;
            display: flex;
            align-items: start;
            gap: 0.75rem;
        }

        .info-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .info-content {
            flex: 1;
        }

        .info-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 0.25rem;
        }

        .info-text {
            font-size: 0.85rem;
            color: #1e3a8a;
            line-height: 1.5;
        }

        /* ---------------- FORM SECTIONS ---------------- */
        .form-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #f1f5f9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: #334155;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .form-label .required {
            color: #ef4444;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 1.25rem;
            border: 1.5px solid #e2e8f0;
            border-radius: 12px;
            font-size: 0.95rem;
            transition: all 0.3s;
            background: white;
            color: #0f172a;
        }

        .form-input:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .form-input:hover {
            border-color: #cbd5e1;
        }

        .form-input::placeholder {
            color: #94a3b8;
        }

        .input-hint {
            display: block;
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: #64748b;
        }

        .text-danger {
            color: #dc2626;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: block;
        }

        /* ---------------- QUILL EDITOR ---------------- */
        .editor-wrapper {
            border: 1.5px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .editor-wrapper:focus-within {
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        #quill-editor {
            min-height: 300px;
            background: white;
            font-size: 0.95rem;
        }

        .ql-toolbar.ql-snow {
            border: none;
            border-bottom: 1.5px solid #f1f5f9;
            background: #f8fafc;
        }

        .ql-container.ql-snow {
            border: none;
        }

        /* ---------------- IMAGE PREVIEW ---------------- */
        .image-preview-wrapper {
            margin-top: 1rem;
            display: none;
        }

        .image-preview-wrapper.show {
            display: block;
        }

        .thumbnail-preview {
            width: 100%;
            max-width: 400px;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 2px solid #e2e8f0;
        }

        .preview-label {
            font-size: 0.85rem;
            color: #64748b;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
        }

        /* ---------------- FORM ACTIONS ---------------- */
        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2.5rem;
            padding-top: 2rem;
            border-top: 1px solid #f1f5f9;
        }

        .btn-submit {
            flex: 1;
            padding: 0.875rem 2rem;
            background: linear-gradient(135deg, #34d399, #10b981);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.35);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-submit:hover {
            background: linear-gradient(135deg, #10b981, #059669);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.45);
        }

        .btn-submit:active {
            transform: translateY(0);
        }

        .btn-cancel {
            flex: 0.6;
            padding: 0.875rem 2rem;
            background: #e2e8f0;
            color: #334155;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-cancel:hover {
            background: #cbd5e1;
            color: #1e293b;
        }

        /* ---------------- RESPONSIVE ---------------- */
        @@media (max-width: 768px) {
            .create-container {
                padding: 1rem 0.75rem;
            }

            .form-card {
                padding: 1.5rem;
            }

            .page-title {
                font-size: 1.6rem;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn-cancel {
                flex: 1;
            }

            #quill-editor {
                min-height: 250px;
            }
        }
    </style>
}

<div class="create-container">
    <a asp-action="Index" class="back-link">
        <span>‚Üê</span>
        <span>Quay l·∫°i danh s√°ch</span>
    </a>

    <div class="page-header">
        <h2 class="page-title">
            <span>üìù</span>
            <span>ƒêƒÉng b√†i vi·∫øt m·ªõi</span>
        </h2>
        <p class="page-subtitle">
            T·∫°o b√†i vi·∫øt tin t·ª©c, c·∫≠p nh·∫≠t th√¥ng tin cho gi·∫£i ƒë·∫•u
        </p>
    </div>

    <div class="form-card">
        <!-- INFO BOX -->
        <div class="info-box">
            <div class="info-icon">üí°</div>
            <div class="info-content">
                <div class="info-title">H∆∞·ªõng d·∫´n vi·∫øt b√†i</div>
                <div class="info-text">
                    H√£y vi·∫øt ti√™u ƒë·ªÅ ng·∫Øn g·ªçn, s√∫c t√≠ch. N·ªôi dung b√†i vi·∫øt h·ªó tr·ª£ ƒë·ªãnh d·∫°ng vƒÉn b·∫£n ƒëa d·∫°ng. ·∫¢nh ƒë·∫°i di·ªán gi√∫p b√†i vi·∫øt thu h√∫t h∆°n.
                </div>
            </div>
        </div>

        <form asp-action="Create" method="post">

            <!-- SECTION 1: BASIC INFO -->
            <div class="form-section">
                <h3 class="section-title">
                    <span>üìå</span>
                    <span>Th√¥ng tin c∆° b·∫£n</span>
                </h3>

                <!-- TI√äU ƒê·ªÄ -->
                <div class="form-group">
                    <label class="form-label">
                        <span>‚úèÔ∏è</span>
                        <span>Ti√™u ƒë·ªÅ b√†i vi·∫øt</span>
                        <span class="required">*</span>
                    </label>
                    <input asp-for="Title" 
                           class="form-input" 
                           placeholder="VD: K·∫øt qu·∫£ tr·∫≠n ƒë·∫•u v√≤ng 10 - CLB A vs CLB B"
                           required />
                    <span asp-validation-for="Title" class="text-danger"></span>
                </div>

                <!-- ·∫¢NH ƒê·∫†I DI·ªÜN -->
                <div class="form-group">
                    <label class="form-label">
                        <span>üñºÔ∏è</span>
                        <span>·∫¢nh ƒë·∫°i di·ªán (URL)</span>
                    </label>
                    <input asp-for="ImageUrl" 
                           id="imgInput"
                           class="form-input" 
                           placeholder="https://example.com/image.jpg" />
                    <span class="input-hint">Nh·∫≠p URL ·∫£nh ho·∫∑c ƒë·ªÉ tr·ªëng ƒë·ªÉ d√πng ·∫£nh m·∫∑c ƒë·ªãnh</span>
                    <span asp-validation-for="ImageUrl" class="text-danger"></span>

                    <div class="image-preview-wrapper" id="previewWrapper">
                        <span class="preview-label">Xem tr∆∞·ªõc:</span>
                        <img id="imgPreview" class="thumbnail-preview" alt="Preview" />
                    </div>
                </div>
            </div>

            <!-- SECTION 2: CONTENT -->
            <div class="form-section">
                <h3 class="section-title">
                    <span>üìÑ</span>
                    <span>N·ªôi dung b√†i vi·∫øt</span>
                </h3>

                <div class="form-group">
                    <label class="form-label">
                        <span>‚úçÔ∏è</span>
                        <span>N·ªôi dung chi ti·∫øt</span>
                        <span class="required">*</span>
                    </label>

                    <div class="editor-wrapper">
                        <div id="quill-editor"></div>
                    </div>

                    <!-- Hidden field ƒë·ªÉ l∆∞u HTML -->
                    <input type="hidden" id="Content" name="Content" />
                    <span class="input-hint">S·ª≠ d·ª•ng thanh c√¥ng c·ª• ƒë·ªÉ ƒë·ªãnh d·∫°ng vƒÉn b·∫£n</span>
                    <span asp-validation-for="Content" class="text-danger"></span>
                </div>
            </div>

            <!-- HIDDEN FIELDS -->
            <input type="hidden" asp-for="PostedDate" value="@DateTime.Now" />
            @{
                var uid = Context.Session.GetInt32("UserId") ?? 0;
            }
            <input type="hidden" asp-for="UserId" value="@uid" />


            <!-- FORM ACTIONS -->
            <div class="form-actions">
                <a asp-action="Index" class="btn-cancel">
                    <span>‚úï</span>
                    <span>H·ªßy b·ªè</span>
                </a>
                <button type="submit" class="btn-submit">
                    <span>üíæ</span>
                    <span>ƒêƒÉng b√†i</span>
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <!-- Quill Editor -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script>
        // QUILL INIT
        var quill = new Quill('#quill-editor', {
            theme: 'snow',
            placeholder: 'Nh·∫≠p n·ªôi dung b√†i vi·∫øt t·∫°i ƒë√¢y...',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline'],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                    ['link', 'image'],
                    ['clean']
                ]
            }
        });

        // Khi submit -> l·∫•y HTML t·ª´ Quill
        document.querySelector("form").onsubmit = function () {
            const content = quill.root.innerHTML;
            document.querySelector("#Content").value = content;

            // Validation
            if (!content || content === '<p><br></p>') {
                alert('Vui l√≤ng nh·∫≠p n·ªôi dung b√†i vi·∫øt!');
                return false;
            }

            const title = document.querySelector('[name="Title"]').value.trim();
            if (!title) {
                alert('Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ b√†i vi·∫øt!');
                return false;
            }

            return true;
        };

        // IMAGE PREVIEW
        const imgInput = document.getElementById("imgInput");
        const imgPreview = document.getElementById("imgPreview");
        const previewWrapper = document.getElementById("previewWrapper");

        imgInput.addEventListener("input", function () {
            const url = this.value.trim();

            if (url.length > 5) {
                imgPreview.src = url;
                previewWrapper.classList.add("show");

                // Handle image load error
                imgPreview.onerror = function() {
                    previewWrapper.classList.remove("show");
                };
            } else {
                previewWrapper.classList.remove("show");
            }
        });

        // Auto-focus title input
        window.addEventListener('load', function() {
            document.querySelector('[name="Title"]').focus();
        });
    </script>
}