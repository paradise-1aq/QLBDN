@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "T·∫°o tr·∫≠n ƒë·∫•u m·ªõi";

    var clubs = ViewBag.Clubs as List<QLBDN.Models.Club> ?? new List<QLBDN.Models.Club>();
    var rounds = ViewBag.Rounds as List<QLBDN.Models.Round> ?? new List<QLBDN.Models.Round>();
    var seasons = ViewBag.Seasons as List<QLBDN.Models.Season> ?? new List<QLBDN.Models.Season>();
}

<style>
    .form-card {
        max-width: 700px;
        margin: 0 auto;
        background: white;
        padding: 2rem;
        border-radius: 16px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    }

    .form-title {
        font-size: 1.7rem;
        font-weight: 800;
        color: #059669;
        margin-bottom: 1.5rem;
        text-align:center;
    }

    .form-group {
        margin-bottom: 1.25rem;
    }

    .form-label {
        font-weight: 700;
        color: #047857;
        margin-bottom: .5rem;
        display:block;
    }

    .form-input, .form-select {
        width: 100%;
        padding: .75rem;
        border-radius: 12px;
        border: 1.5px solid #e5e7eb;
        font-size: 1rem;
        transition: .2s;
        background:#fafafa;
    }

    .form-input:focus, .form-select:focus {
        border-color:#34d399;
        box-shadow:0 0 0 3px rgba(52,211,153,0.2);
        background:white;
    }

    .btn-submit {
        width:100%;
        padding:1rem;
        font-size:1.1rem;
        font-weight:700;
        border:none;
        border-radius:12px;
        background:linear-gradient(135deg,#10b981,#059669);
        color:white;
        cursor:pointer;
        transition:.2s;
    }

    .btn-submit:hover {
        transform:translateY(-2px);
        box-shadow:0 4px 14px rgba(16,185,129,0.35);
    }
</style>

<div class="form-card">
    <h2 class="form-title">‚ûï T·∫°o tr·∫≠n ƒë·∫•u m·ªõi</h2>

    @if (TempData["Error"] != null)
    {
        <div style="background:#fee2e2; padding:1rem; border-radius:12px; margin-bottom:1rem; color:#b91c1c;">
            ‚ö† @TempData["Error"]
        </div>
    }

    <form method="post" asp-action="Create">
        <!-- Season -->
        <div class="form-group">
            <label class="form-label">üìÖ M√πa gi·∫£i</label>
            <select name="seasonId" class="form-select" required>
                @foreach (var s in seasons)
                {
                    <option value="@s.SeasonId">@s.Name</option>
                }
            </select>
        </div>

        <!-- Round -->
        <div class="form-group">
            <label class="form-label">üîÑ Lo·∫°i v√≤ng ƒë·∫•u</label>
            <select name="roundId" class="form-input" required>
                @foreach (var r in rounds)
                {
                    string roundLabel = r.RoundName;

                    // N·∫øu l√† v√≤ng b·∫£ng th√¨ th√™m b·∫£ng A/B
                    if (r.RoundName == "V√≤ng b·∫£ng" && !string.IsNullOrEmpty(r.TableName))
                    {
                        roundLabel = $"{r.RoundName} - B·∫£ng {r.TableName}";
                    }

                    <option value="@r.RoundId">@roundLabel</option>
                }
            </select>

        </div>

        <!-- TABLE A/B (Ch·ªâ hi·ªán khi Round = V√≤ng b·∫£ng) -->
        <div class="form-group" id="tableSelectWrapper" style="display:none;">
            <label class="form-label">üìå B·∫£ng ƒë·∫•u</label>
            <select name="tableName" class="form-select">
                <option value="A">B·∫£ng A</option>
                <option value="B">B·∫£ng B</option>
            </select>
        </div>

        <!-- Home Team -->
        <div class="form-group">
            <label class="form-label">üè† ƒê·ªôi ch·ªß nh√†</label>
            <select name="homeClubId" class="form-select" required>
                @foreach (var c in clubs)
                {
                    <option value="@c.ClubId">@c.Name</option>
                }
            </select>
        </div>

        <!-- Away Team -->
        <div class="form-group">
            <label class="form-label">üö© ƒê·ªôi kh√°ch</label>
            <select name="awayClubId" class="form-select" required>
                @foreach (var c in clubs)
                {
                    <option value="@c.ClubId">@c.Name</option>
                }
            </select>
        </div>

        <!-- Stadium -->
        <div class="form-group">
            <label class="form-label">üèü S√¢n v·∫≠n ƒë·ªông</label>
            <input type="text" name="stadium" class="form-input" placeholder="Nh·∫≠p t√™n s√¢n..." required />
        </div>

        <!-- Date -->
        <div class="form-group">
            <label class="form-label">üìÜ Th·ªùi gian thi ƒë·∫•u</label>
            <input type="datetime-local" name="dateTime" class="form-input" required />
        </div>

        <button class="btn-submit">T·∫°o tr·∫≠n ƒë·∫•u</button>
    </form>
</div>

<script>
    function toggleTableSelect() {
        const roundSelect = document.getElementById("roundSelect");
        const tableWrap = document.getElementById("tableSelectWrapper");

        const selected = roundSelect.options[roundSelect.selectedIndex]
            .getAttribute("data-roundname");

        if (selected === "V√≤ng b·∫£ng") {
            tableWrap.style.display = "block";
        } else {
            tableWrap.style.display = "none";
        }
    }

    // Run once on load
    toggleTableSelect();
</script>
